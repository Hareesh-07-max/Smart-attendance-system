<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Attendance Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-6">
  <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-3xl">
    <h1 class="text-2xl font-bold text-center text-indigo-700 mb-6">üìä Student Attendance Portal</h1>

    <!-- Input -->
    <div class="flex items-center gap-2 mb-6">
      <input id="studentIdInput" type="text" placeholder="Enter your ID Number (e.g. R230557)" 
        class="flex-1 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
      <button onclick="searchAttendance()" 
        class="bg-indigo-600 text-white px-4 py-3 rounded-lg hover:bg-indigo-700 transition">Search</button>
    </div>

    <!-- Results -->
    <div id="resultArea" class="hidden">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Attendance Records</h2>
      <div class="overflow-x-auto">
        <table class="w-full border border-gray-300 rounded-lg overflow-hidden">
          <thead class="bg-indigo-100">
            <tr>
              <th class="border px-4 py-2">Date/Time</th>
              <th class="border px-4 py-2">ID Number</th>
              <th class="border px-4 py-2">Status</th>
            </tr>
          </thead>
          <tbody id="attendanceTable" class="text-center"></tbody>
        </table>
      </div>

      <div class="mt-6 bg-green-50 border border-green-200 p-4 rounded-lg">
        <p id="percentageText" class="text-green-800 font-medium"></p>
      </div>
    </div>

    <!-- Error -->
    <div id="errorArea" class="hidden mt-6">
      <div class="bg-red-50 border border-red-200 p-4 rounded-lg text-red-700">
        ‚ùå No records found for this ID number.
      </div>
    </div>
  </div>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRdMHIJ5IUW60rjdruE-lh96vAEcaJxbL55h-P2AKnbLwu45xgRMmU-fEoO3lwS8ypeIzZjpGmzHbvF/pub?output=csv";

    async function fetchCSV() {
      const response = await fetch(sheetUrl);
      const data = await response.text();
      return data.split("\n").map(row => row.split(","));
    }

    async function searchAttendance() {
      const studentId = document.getElementById("studentIdInput").value.trim().toUpperCase();
      const tableBody = document.getElementById("attendanceTable");
      const resultArea = document.getElementById("resultArea");
      const errorArea = document.getElementById("errorArea");
      const percentageText = document.getElementById("percentageText");

      tableBody.innerHTML = "";
      resultArea.classList.add("hidden");
      errorArea.classList.add("hidden");

      if (!studentId) return;

      const rows = await fetchCSV();

      // First row = header
      const header = rows[0];
      const dateIndex = 0;  
      const idIndex = 1;    // ‚úÖ First "ID Number" column only
      const statusIndex = 2; // Assuming 3rd column is Status (Present/Absent)

      let total = 0, present = 0;
      rows.slice(1).forEach(row => {
        if (row[idIndex] && row[idIndex].trim().toUpperCase() === studentId) {
          total++;
          if (row[statusIndex] && row[statusIndex].toLowerCase().includes("present")) {
            present++;
          }

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="border px-4 py-2">${row[dateIndex]}</td>
            <td class="border px-4 py-2">${row[idIndex]}</td>
            <td class="border px-4 py-2">${row[statusIndex]}</td>
          `;
          tableBody.appendChild(tr);
        }
      });

      if (total > 0) {
        const percentage = ((present / total) * 100).toFixed(2);
        percentageText.textContent = `‚úÖ Attendance: ${present}/${total} (${percentage}%)`;
        resultArea.classList.remove("hidden");
      } else {
        errorArea.classList.remove("hidden");
      }
    }
  </script>
</body>
</html>
