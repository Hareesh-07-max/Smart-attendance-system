<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teacher Dashboard - Smart Attendance</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-indigo-100 min-h-screen p-6">

  <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">👩‍🏫 Teacher Dashboard</h1>

  <div class="bg-white p-6 rounded-xl shadow-md max-w-6xl mx-auto">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">📊 All Students Attendance</h2>
    
    <table class="min-w-full border border-gray-300">
      <thead class="bg-indigo-200">
        <tr>
          <th class="border border-gray-300 px-4 py-2">Roll Number</th>
          <th class="border border-gray-300 px-4 py-2">Total Classes</th>
          <th class="border border-gray-300 px-4 py-2">Present</th>
          <th class="border border-gray-300 px-4 py-2">Attendance %</th>
        </tr>
      </thead>
      <tbody id="attendanceTable" class="text-center bg-white"></tbody>
    </table>
  </div>

  <script>
    async function loadAttendance() {
      // ✅ Your actual sheet link
      const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRdMHIJ5IUW60rjdruE-lh96vAEcaJxbL55h-P2AKnbLwu45xgRMmU-fEoO3lwS8ypeIzZjpGmzHbvF/pub?output=csv";

      const response = await fetch(csvUrl);
      const data = await response.text();

      const rows = data.split("\n").map(r => r.split(","));
      const header = rows[0]; 
      const rollIndex = header.indexOf("Roll Number");

      if (rollIndex === -1) {
        alert("⚠️ 'Roll Number' column not found in sheet!");
        return;
      }

      let records = {};

      rows.slice(1).forEach(row => {
        const roll = row[rollIndex]?.trim();
        if (roll) {
          if (!records[roll]) {
            records[roll] = { total: 0, present: 0 };
          }
          records[roll].total++;
          records[roll].present++; // Every entry = Present
        }
      });

      const tbody = document.getElementById("attendanceTable");
      tbody.innerHTML = "";

      Object.keys(records).forEach(roll => {
        const { total, present } = records[roll];
        const percentage = ((present / total) * 100).toFixed(2);

        const row = `<tr>
          <td class="border border-gray-300 px-4 py-2">${roll}</td>
          <td class="border border-gray-300 px-4 py-2">${total}</td>
          <td class="border border-gray-300 px-4 py-2">${present}</td>
          <td class="border border-gray-300 px-4 py-2">${percentage}%</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    loadAttendance();
  </script>
</body>
</html>
